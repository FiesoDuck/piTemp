<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rel="icon" type="image/gif" href="img/favicon.png" />
<link rel="stylesheet" type="text/css" href="style.css">
<title>piTemp</title>
<script src="../libraries/jquery-1.8.3.min.js" type="text/javascript"></script>
<script src="../libraries/RGraph.common.core.js" ></script>
<script src="../libraries/RGraph.common.effects.js" ></script>
<script src="../libraries/RGraph.vprogress.js" ></script>
<script type="text/javascript">													// Schalter initiieren 
var moehre = 0;		
var timevar = 1000;
var thermometer = {};
var schalter = 0;
focusvar = 1;

window.onblur= function() {
focusvar=0;
}

window.onfocus= function() {
focusvar=1;
ausgeben ();
}

function initGraph (json) {
thermometer[0] = new RGraph.VProgress({id: 'g0', min: 0, max: 120, value: 0, options: {gutter: {right: 2, left:  30, bottom: 10}, labels: {position: "left" , count: 5}, colors:['#33CC33']}}).draw();
thermometer[1] = new RGraph.VProgress({id: 'g1', min: 0, max: 40,  value: 0, options: {gutter: {left:  2, right: 30, bottom: 10}, labels: {position: "right", count: 5}, colors:['#7798BF']}}).draw();
thermometer[2] = new RGraph.VProgress({id: 'g2', min: 0, max: 120, value: 0, options: {gutter: {right: 2, left:  30, bottom: 10}, labels: {position: "left" , count: 5}, colors:['#33CC33']}}).draw();
thermometer[3] = new RGraph.VProgress({id: 'g3', min: 0, max: 40,  value: 0, options: {gutter: {left:  2, right: 30, bottom: 10}, labels: {position: "right", count: 5}, colors:['#7798BF']}}).draw();
thermometer[4] = new RGraph.VProgress({id: 'g4', min: 0, max: 120, value: 0, options: {gutter: {right: 2, left:  30, bottom: 10}, labels: {position: "left" , count: 5}, colors:['#33CC33']}}).draw();
thermometer[5] = new RGraph.VProgress({id: 'g5', min: 0, max: 40,  value: 0, options: {gutter: {left:  2, right: 30, bottom: 10}, labels: {position: "right", count: 5}, colors:['#7798BF']}}).draw();
thermometer[6] = new RGraph.VProgress({id: 'g6', min: 0, max: 120, value: 0, options: {gutter: {right: 2, left:  30, bottom: 10}, labels: {position: "left" , count: 5}, colors:['#33CC33']}}).draw();
thermometer[7] = new RGraph.VProgress({id: 'g7', min: 0, max: 40,  value: 0, options: {gutter: {left:  2, right: 30, bottom: 10}, labels: {position: "right", count: 5}, colors:['#7798BF']}}).draw();
}

function getData(){	
var data;
var jsonurl = './tnow.json';
$.ajax({
	type: "GET",
	url: jsonurl,	// Daten-Stream url
	data: data,	// Variable für json Container
	async: true,	
	dataType: "json",
	success: function(data){	// nur ausführen wenn getJson (hier ajax) erfolgreich war
	console.log("get ./tnow.json");
	celsius = data.temperature_record;
	ausgeben();
	},
	error: function(){alert('Der Server antwortet nicht!');}
	});	
}	

function ausgeben () {
if (schalter == "on" && focusvar ==1) {
	if (moehre == 8) {
		moehre = 0;
		getData();
		}
	else {
		thermometer[moehre].value = celsius[moehre];
		$('#data'+moehre).text(celsius[moehre]);
		thermometer[moehre].grow();
		moehre++;
		setTimeout(ausgeben, timevar);
	}
}
else if (schalter == "off") {
	moehre = 0;
	}
}
	
function choose(choice){
schalter = choice;
ausgeben();
}	
	
</script>
</head>
<body>
<div id="container">
<img src="img/banner.png"/></a>
	<nav>
		<ul>
			<li><a href="multi.htm">read temperature</a></li>
			<li><a href="check.htm">config</a></li>
		</ul>
	</nav>
  <aside>
	<div id="buttons">
		<b>Status:</b>
		<br>
		<button onClick="choose('on')">On</button>
		<button onClick="choose('off')">Off</button>
		<br><br>
		<b>Timing:</b>
		<br>
		<input type="range" min="0" max="1000" value="500" step="100" onchange="timevar = this.value" 
	</div>	
</aside>
<section id="content">			
			<table class="tg">
			  <tr>
				<th class="c0"><canvas id="g0" width="80" height="200">[No canvas support]</canvas><canvas id="g1" width="80" height="200">[No canvas support]</canvas> <br> <span id="data0">0</span> °C <br> <span id="data1">0</span> l/min</th>
				<th class="c1"><canvas id="g2" width="80" height="200">[No canvas support]</canvas><canvas id="g3" width="80" height="200">[No canvas support]</canvas> <br> <span id="data2">0</span> °C <br> <span id="data3">0</span> l/min</th>
				<th class="c2"><canvas id="g4" width="80" height="200">[No canvas support]</canvas><canvas id="g5" width="80" height="200">[No canvas support]</canvas> <br> <span id="data4">0</span> °C <br> <span id="data5">0</span> l/min</th>
				<th class="c3"><canvas id="g6" width="80" height="200">[No canvas support]</canvas><canvas id="g7" width="80" height="200">[No canvas support]</canvas> <br> <span id="data6">0</span> °C <br> <span id="data7">0</span> l/min</th>
			  </tr>
			</table>
  </section>
<footer>		
</footer>
<script>initGraph(); getData();</script>
	</body>
</html>
