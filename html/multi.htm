<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<title>piTemp</title>
<script src="../libraries/jquery-1.8.3.min.js" type="text/javascript"></script>
<script src="../libraries/RGraph.common.core.js" ></script>
<script src="../libraries/RGraph.common.effects.js" ></script>
<script src="../libraries/RGraph.thermometer.js" ></script>
<script type="text/javascript">
var schalter = "off";													// Schalter initiieren 
var moehre = 0;															// Schleifenzähler nicht i!!! wird in graph-script verwendet 										
var deviceid;
thermometer = new Array();

// Auswahl Benutzereingabe
function choose(choice){
	schalter = choice;
	if (document.getElementById('g0c').checked) {getData(0,"g0",0)}
	if (document.getElementById('g1c').checked) {getData(1,"g1",1)}
}

// Daten aus json lesen, abhängig von User Eingabe
function getData(deviceurl,gid,tid){	
	var data;
	var jsonurl = './tnow_' + deviceurl + '.json';
	console.log('Url    | %o', jsonurl);
	
	console.log('getData  | %o | Aufruf', schalter);
	if (schalter == 'update' || schalter == 'on') {							// nur Daten laden wenn "update" oder "on" vorliegt um Traffic zu vermeiden
		$.ajax({
			type: "GET",
			url: jsonurl,													// Daten-Stream url
			data: data,														// Variable für json Container
			async: true,										
			dataType: "json",
			success: function(data){										// nur ausführen wenn getJson (hier ajax) erfolgreich war
				moehre++;
				var celsius = data.temperature_record[tid];
				
				console.log('getData  | %o | Angekommen | %o', schalter, moehre);
				//ausgeben(deviceurl, celsius, gid, tid);
				graph(schalter, celsius, gid, tid);
				if (schalter == 'update') {schalter = "nan";}				// damit keine schleife entsteht
			},
			error: function(){alert('Der Server antwortet nicht!');}
			});
		}
			
	else if (schalter == "clear") {											// Daten löschen
		$('#temp').text("keine Daten");
		console.log("getData  | %o", schalter);
		graph(schalter, "0.0");
		divvv.style.backgroundColor = 'white';
	}
			
	else {console.log('getData  | %o | Abbruch', schalter);}		
}	
	
// Anzeigen von Daten aufgrund von User Eingabe, Aufruf durch getData()
function ausgeben(deviceid, celsius, gid, tid) {	
	if (schalter == "on") {
		getData(deviceid, gid, tid);														// hier startet loop
		//$('#temp').text(celsius);
		//console.log("Ausgeben | %o", schalter);
		//divvv.style.backgroundColor = '#99FF33';
	}
	else if (schalter == "off") {												// loop stoppen
		console.log("Ausgeben | %o", schalter);	
		divvv.style.backgroundColor = '#FF4D4D';
	}
	else if (schalter == "update") {											// einmaliges updaten der Daten
		console.log("Ausgeben | %o", schalter);									// da schaler=="update" in getData()
		$('#temp').text(celsius);												// auf schalter=="nan" gesetzt wird
		divvv.style.backgroundColor = 'white';
	}			
}

function graph (schalter, celsius, gid, tid) {	
	if (schalter == "on" || schalter == "update") {
		var value = celsius;
			if (typeof thermometer[tid] == 'undefined') {
				thermometer[tid]= new RGraph.Thermometer({id: gid, min: 0, max: 50, value: value});
			} 
			else {
				thermometer[tid].value = value;
			}
			thermometer[tid].grow()				
			}
		else if (schalter == "off")
		{
		}
		else if (schalter == "clear")
		{
		graph("on", 0.0, gid, tid);
		console.log("Graph    | %o", schalter);
		}
}

function graphinit() {
graph("on", 0.0, "g0", 0);
graph("on", 0.0, "g1", 1);
graph("on", 0.0, "g2", 2);
graph("on", 0.0, "g3", 3);
graph("on", 0.0, "g4", 4);
graph("on", 0.0, "g5", 5);
graph("on", 0.0, "g6", 6);
graph("on", 0.0, "g7", 7);
}
</script>
</head>
<body>
<div id="container">
<img src="img/banner.png"/></a>
	<nav>
		<ul>
			<li><a href="single.htm">read temperature</a></li>
			<li><a href="multi.htm">read multi temperature</a></li>
			<li><a href="check.htm">config</a></li>
		</ul>
	</nav>
  <aside>
	<div id="buttons">
		<b>choose device:</b>
		<p>
		Temp 1 <input id="g0c" name="g0c" type="checkbox" autocomplete="off"/><br>
		Temp 2 <input id="g1c" name="g1c" type="checkbox" autocomplete="off"/><br>
		Temp 3 <input id="g2c" name="g2c" type="checkbox"/><br>
		Temp 4 <input id="g3c" name="g3c" type="checkbox"/><br>
		Temp 5 <input id="g4c" name="g4c" type="checkbox"/><br>
		Temp 6 <input id="g5c" name="g5c" type="checkbox"/><br>
		Temp 7 <input id="g6c" name="g6c" type="checkbox"/><br>
		Temp 8 <input id="g7c" name="g7c" type="checkbox"/>
		<br>
		<p>
		<b>control device:</b>
		<br>
		<button onClick="choose('on')">On</button>
		<button onClick="choose('off')">Off</button>
		<br>
		<button onClick="choose('update')">update</button>
		<button onClick="choose('clear')">clear</button>
	</div>	
</aside>
<section id="content">
	<article>	
		<div id="log">	
		<h1><span id="logback">Temperatur</span></h></div>
		<div id="temp">keine Daten</div>
		<canvas id="g0" width="80" height="300">[No canvas support]</canvas>
		<canvas id="g1" width="80" height="300">[No canvas support]</canvas> 
		<canvas id="g2" width="80" height="300">[No canvas support]</canvas> 
		<canvas id="g3" width="80" height="300">[No canvas support]</canvas> 
		<canvas id="g4" width="80" height="300">[No canvas support]</canvas> 
		<canvas id="g5" width="80" height="300">[No canvas support]</canvas> 
		<canvas id="g6" width="80" height="300">[No canvas support]</canvas> 
		<canvas id="g7" width="80" height="300">[No canvas support]</canvas> 
	</article>
  </section>
<footer>		
</footer>
</div>
	<script>graphinit(); var divvv = document.getElementById('logback');</script>
	</body>
</html>
